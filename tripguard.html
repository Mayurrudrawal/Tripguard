<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>TripGuard - Tourist Safety System (Demo)</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
    <style>
      :root {
        --primary: #2563eb;
        --primary-dark: #1e40af;
        --secondary: #64748b;
        --success: #22c55e;
        --warning: #f59e0b;
        --danger: #ef4444;
        --light: #f8fafc;
        --dark: #1e293b;
        --gray: #94a3b8;
        --background: #f1f5f9;
        --card: #ffffff;
        --sidebar: #1e2a38;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: var(--background);
        color: var(--dark);
        line-height: 1.5;
      }
      .container {
        max-width: 1200px;
        margin: 20px auto;
        padding: 18px;
      }
      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        background: var(--card);
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
        margin-bottom: 16px;
      }
      .logo {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .logo h1 {
        color: var(--primary);
        font-size: 20px;
      }
      .tabs {
        background: var(--card);
        border-radius: 10px;
        padding: 0;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
        margin-bottom: 16px;
      }
      .tab-headers {
        display: flex;
        background: var(--light);
        border-radius: 10px 10px 0 0;
        overflow: hidden;
      }
      .tab-btn {
        flex: 1;
        padding: 12px;
        text-align: center;
        border: 0;
        background: none;
        cursor: pointer;
        color: var(--secondary);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
      }
      .tab-btn.active {
        background: var(--card);
        color: var(--primary);
        border-bottom: 3px solid var(--primary);
      }
      .tab-content {
        padding: 16px;
        min-height: 520px;
      }
      .tab-pane {
        display: none;
      }
      .tab-pane.active {
        display: block;
      }
      .mobile-frame {
        width: 390px;
        height: 844px;
        margin: 0 auto;
        background: var(--card);
        border-radius: 30px;
        overflow: hidden;
        border: 10px solid #1e293b;
      }
      .mobile-content {
        padding: 16px;
        height: 100%;
        overflow: auto;
      }
      .score-circle {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 8px auto;
        background: linear-gradient(90deg, #22c55e, #f59e0b);
      }
      .score-inner {
        width: 100px;
        height: 100px;
        background: white;
        border-radius: 50%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      .map-container {
        height: 220px;
        background: linear-gradient(90deg, #f8fafc, #eef2ff);
        border-radius: 12px;
        position: relative;
        overflow: hidden;
        margin: 12px 0;
      }
      #map,
      #auth-map {
        height: 100%;
        width: 100%;
      }
      .action-buttons {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
        margin: 8px 0;
      }
      .btn {
        padding: 10px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
      }
      .btn-primary {
        background: var(--primary);
        color: white;
      }
      .btn-danger {
        background: var(--danger);
        color: white;
      }
      .btn-outline {
        background: transparent;
        border: 1px solid var(--primary);
        color: var(--primary);
      }
      .panic-btn {
        grid-column: span 2;
        background: var(--danger);
        color: white;
        padding: 14px;
        font-size: 16px;
      }
      .features,
      .instructions {
        margin-top: 16px;
      }
      .dashboard {
        display: grid;
        grid-template-columns: 250px 1fr;
        gap: 14px;
      }
      .sidebar {
        background: var(--sidebar);
        color: white;
        padding: 12px;
        border-radius: 8px;
      }
      .sidebar-item {
        padding: 10px;
        border-radius: 6px;
        cursor: pointer;
        margin-bottom: 4px;
      }
      .sidebar-item.active {
        background: var(--primary);
      }
      .card {
        background: var(--card);
        padding: 12px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      th,
      td {
        padding: 8px;
        border-bottom: 1px solid #eee;
        text-align: left;
      }
      .heatmap-container {
        height: 220px;
        border-radius: 8px;
        overflow: hidden;
      }
      .badge {
        background: #f3f4f6;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
      }
      .alert-item {
        padding: 10px;
        border-left: 4px solid var(--danger);
        background: #fff0f0;
        border-radius: 6px;
        margin-bottom: 8px;
      }
      .muted {
        color: var(--secondary);
        font-size: 13px;
      }
      .hidden {
        display: none;
      }
      .cluster-marker {
        background: var(--primary);
        color: white;
        padding: 8px 12px;
        border-radius: 20px;
        font-size: 14px;
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }
      input,
      textarea,
      select {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }
      @media (max-width: 900px) {
        .dashboard {
          grid-template-columns: 1fr;
        }
        .mobile-frame {
          width: 100%;
          height: 600px;
        }
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/main.tsx"></script>
    <div class="container">
      <div id="login-screen">
        <div class="card" style="max-width: 420px; margin: 30px auto">
          <div style="text-align: center; margin-bottom: 10px">
            <div class="logo" style="justify-content: center">
              <i class="fas fa-shield-alt" style="font-size: 28px; color: var(--primary)"></i>
              <h1>TripGuard</h1>
            </div>
            <p class="muted">Tourist Safety Platform ‚Äî Demo</p>
          </div>
          <div style="margin-top:10px">
            <label>Role</label>
            <select id="role-select" style="width:100%;padding:10px;border-radius:6px;border:1px solid #ddd;margin-top:6px">
              <option value="tourist">Tourist</option>
              <option value="authority">Authority</option>
            </select>
          </div>
          <div style="margin-top: 12px">
            <label>Email</label>
            <input id="email" type="email" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ddd; margin-top: 6px;"/>
          </div>
          <div style="margin-top: 10px">
            <label>Password</label>
            <input id="password" type="password" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ddd; margin-top: 6px;"/>
          </div>
          <div id="tourist-kyc" style="margin-top:10px">
            <label style="display:block;margin-bottom:6px">Identity Type</label>
            <select id="id-type" style="width:100%;padding:10px;border-radius:6px;border:1px solid #ddd;margin-bottom:8px">
              <option value="aadhar" selected>Aadhar</option>
              <option value="passport">Passport</option>
            </select>
            <div id="kyc-aadhar">
              <label>Aadhar Number</label>
              <input id="aadhar" maxlength="12" placeholder="Enter 12-digit Aadhar" style="width:100%;padding:10px;border-radius:6px;border:1px solid #ddd;margin-top:6px"/>
            </div>
            <div id="kyc-passport" style="display:none">
              <label>Passport Number</label>
              <input id="passport" maxlength="8" placeholder="Format: A1234567" style="width:100%;padding:10px;border-radius:6px;border:1px solid #ddd;margin-top:6px;text-transform:uppercase"/>
            </div>
          </div>
          <div id="authority-fields" style="margin-top:10px;display:none">
            <label>Authority ID</label>
            <input id="authority-id" style="width:100%;padding:10px;border-radius:6px;border:1px solid #ddd;margin-top:6px"/>
          </div>
          <div style="margin-top: 12px; display: flex; gap: 8px">
            <button id="btn-login" class="btn btn-primary" onclick="login()" data-i18n="login">Login</button>
            <button id="btn-register" class="btn btn-outline" onclick="register()" data-i18n="register">Register</button>
          </div>
          <div style="text-align:center;margin-top:8px;color:var(--secondary);font-size:13px">Tip: Use any email/password for demo.</div>
        </div>
      </div>

      <div id="app-container" class="hidden">
        <header>
          <div style="display: flex; align-items: center; gap: 12px">
            <i
              class="fas fa-shield-alt"
              style="font-size: 20px; color: var(--primary)"
            ></i>
            <div>
              <h1 style="margin: 0; font-size: 18px">TripGuard</h1>
              <div class="muted" id="user-info">Welcome</div>
            </div>
          </div>
          <div style="display: flex; align-items: center; gap: 12px">
            <div class="muted" id="header-safety">Safety Score: --</div>
            <div class="muted" id="alert-count-display">0 Active Alerts</div>
            <button class="btn btn-outline" onclick="logout()">Logout</button>
          </div>
        </header>

        <div class="tabs">
          <div class="tab-headers" role="tablist">
            <button
              id="tab-tourist"
              class="tab-btn active"
              data-tab="tourist"
              onclick="switchTab(event,'tourist')"
            >
              <i class="fas fa-mobile-alt"></i>
              <span data-i18n="tourist_interface">Tourist Interface</span>
            </button>
            <button
              id="tab-authority"
              class="tab-btn"
              data-tab="authority"
              onclick="switchTab(event,'authority')"
            >
              <i class="fas fa-desktop"></i>
              <span data-i18n="authority_dashboard">Authority Dashboard</span>
              <span class="badge" id="authority-count">0</span>
            </button>
            <button
              id="tab-analytics"
              class="tab-btn"
              data-tab="analytics"
              onclick="switchTab(event,'analytics')"
            >
              <i class="fas fa-chart-line"></i>
              <span data-i18n="analytics">Analytics</span>
            </button>
          </div>
          <div class="tab-content">
            <div class="tab-pane active" id="tourist-tab">
              <div class="mobile-frame">
                <div class="mobile-content">
                  <div
                    style="
                      display: flex;
                      justify-content: space-between;
                      align-items: center;
                    "
                  >
                    <div>
                      <strong id="tourist-name">Tourist</strong>
                      <div class="muted" id="tourist-id">ID: --</div>
                    </div>
                    <div>
                      <select
                        id="language-select"
                        style="padding: 6px; border-radius: 6px"
                      >
                        <option value="en" selected>English</option>
                        <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                        <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
                        <option value="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä</option>
                        <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
                        <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
                        <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
                        <option value="ml">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</option>
                        <option value="gu">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä</option>
                        <option value="pa">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä</option>
                        <option value="or">‡¨ì‡¨°‡¨º‡¨ø‡¨Ü</option>
                        <option value="as">‡¶Ö‡¶∏‡¶Æ‡ßÄ‡¶Ø‡¶º‡¶æ</option>
                      </select>
                    </div>
                  </div>

                  <div class="score-circle" id="safety-circle">
                    <div class="score-inner">
                      <div
                        id="safety-score"
                        style="font-size: 20px; font-weight: 700"
                      >
                        --
                      </div>
                      <div class="muted" style="font-size: 13px">Safety</div>
                    </div>
                  </div>

                  <div class="map-container card" style="padding: 0">
                    <div id="map"></div>
                  </div>

                  <div style="margin-top: 8px">
                    <small class="muted"
                      >Plan your route, see safe route, and start tracking.
                      Police/hospitals are shown on the map</small
                    >
                  </div>

                  <div class="action-buttons">
                    <button
                      id="btn-route"
                      class="btn btn-primary"
                      onclick="openRoutePlanner()"
                      data-i18n="route_planner"
                    >
                      Route Planner
                    </button>
                    <button
                      id="btn-family"
                      class="btn btn-primary"
                      onclick="toggleFamilyTracking(true)"
                      data-i18n="start_family"
                    >
                      Start Family Tracking
                    </button>
                    <button
                      id="btn-share"
                      class="btn btn-outline"
                      onclick="shareLocation()"
                      data-i18n="share_location"
                    >
                      Share Location
                    </button>
                    <button
                      id="btn-itinerary"
                      class="btn btn-outline"
                      onclick="showItinerary()"
                      data-i18n="my_itinerary"
                    >
                      My Itinerary
                    </button>
                    <button
                      id="btn-panic"
                      class="panic-btn"
                      onclick="triggerPanicAlert()"
                    >
                      <i class="fas fa-bell"></i> üö®
                      <span data-i18n="panic">Panic</span>
                    </button>
                  </div>

                  <div style="margin-top: 12px">
                    <button
                      id="btn-voice"
                      class="btn btn-outline"
                      onclick="startVoiceControl()"
                      data-i18n="voice_control"
                    >
                      Start Voice Control (say 'panic')
                    </button>
                    <div style="margin-top: 8px">
                      <h4>Feedback</h4>
                      <div style="display: flex; gap: 6px; margin-bottom: 6px">
                        <i
                          class="fas fa-star"
                          id="star1"
                          onclick="setRating(1)"
                          style="cursor: pointer; color: #ccc"
                        ></i>
                        <i
                          class="fas fa-star"
                          id="star2"
                          onclick="setRating(2)"
                          style="cursor: pointer; color: #ccc"
                        ></i>
                        <i
                          class="fas fa-star"
                          id="star3"
                          onclick="setRating(3)"
                          style="cursor: pointer; color: #ccc"
                        ></i>
                        <i
                          class="fas fa-star"
                          id="star4"
                          onclick="setRating(4)"
                          style="cursor: pointer; color: #ccc"
                        ></i>
                        <i
                          class="fas fa-star"
                          id="star5"
                          onclick="setRating(5)"
                          style="cursor: pointer; color: #ccc"
                        ></i>
                      </div>
                      <textarea
                        id="feedback-input"
                        rows="3"
                        style="
                          width: 100%;
                          padding: 8px;
                          border-radius: 6px;
                          border: 1px solid #ddd;
                        "
                      ></textarea>
                      <div style="margin-top: 6px; display: flex; gap: 8px">
                        <button
                          class="btn btn-primary"
                          onclick="submitFeedback()"
                        >
                          Submit
                        </button>
                        <button
                          class="btn btn-outline"
                          onclick="viewFeedback()"
                        >
                          View Feedback
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="tab-pane" id="authority-tab">
              <div class="dashboard">
                <div class="sidebar">
                  <div
                    style="
                      background: var(--primary);
                      padding: 8px;
                      border-radius: 6px;
                      margin-bottom: 8px;
                    "
                  >
                    <div><strong>Authority</strong></div>
                    <div class="muted">ID: AUTH-001</div>
                  </div>
                  <div style="display: flex; flex-direction: column; gap: 6px">
                    <div
                      class="sidebar-item active"
                      onclick="switchAuthorityTab(event,'monitoring')"
                    >
                      <i class="fas fa-users"></i> Monitoring
                    </div>
                    <div
                      class="sidebar-item"
                      onclick="switchAuthorityTab(event,'risk-zones')"
                    >
                      <i class="fas fa-exclamation-triangle"></i> Risk Zones
                    </div>
                    <div
                      class="sidebar-item"
                      onclick="switchAuthorityTab(event,'alerts')"
                    >
                      <i class="fas fa-bell"></i> Alerts
                    </div>
                    <div
                      class="sidebar-item"
                      onclick="switchAuthorityTab(event,'efir')"
                    >
                      <i class="fas fa-file-alt"></i> E-FIR
                    </div>
                  </div>
                </div>

                <div class="main-content">
                  <div class="card" id="authority-monitoring">
                    <div
                      style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                      "
                    >
                      <h3>Tourist Cluster Heatmap</h3>
                      <div class="muted">Simulated clusters</div>
                    </div>
                    <div
                      id="auth-map"
                      class="heatmap-container"
                      style="margin-top: 8px"
                    ></div>
                    <div style="margin-top: 8px">
                      <h4>Cluster summary</h4>
                      <div
                        id="cluster-list"
                        style="display: flex; gap: 8px; flex-wrap: wrap"
                      ></div>
                    </div>
                  </div>

                  <div style="display: flex; flex-direction: column; gap: 12px">
                    <div class="card">
                      <div
                        style="
                          display: flex;
                          justify-content: space-between;
                          align-items: center;
                        "
                      >
                        <h4 data-i18n="active_alerts">Active Alerts</h4>
                        <div class="badge" id="authority-alert-count">0</div>
                      </div>
                      <div id="alerts-list" style="margin-top: 8px"></div>
                    </div>

                    <div class="card" id="efir-card" style="display: none">
                      <h4>Generate E-FIR</h4>
                      <div
                        style="display: flex; flex-direction: column; gap: 8px"
                      >
                        <input
                          id="efir-name"
                          placeholder="Tourist Name"
                          style="
                            padding: 8px;
                            border-radius: 6px;
                            border: 1px solid #ddd;
                          "
                        />
                        <input
                          id="efir-id"
                          placeholder="Tourist ID"
                          style="
                            padding: 8px;
                            border-radius: 6px;
                            border: 1px solid #ddd;
                          "
                        />
                        <input
                          id="efir-location"
                          placeholder="Last known location"
                          style="
                            padding: 8px;
                            border-radius: 6px;
                            border: 1px solid #ddd;
                          "
                        />
                        <textarea
                          id="efir-details"
                          rows="4"
                          placeholder="Details..."
                          style="
                            padding: 8px;
                            border-radius: 6px;
                            border: 1px solid #ddd;
                          "
                        ></textarea>
                        <div style="display: flex; gap: 8px">
                          <button
                            class="btn btn-primary"
                            onclick="generateEFIR()"
                          >
                            Generate & Download
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="tab-pane" id="analytics-tab">
              <div class="card">
                <h3>Analytics & Simulations</h3>
                <p class="muted">
                  Behavior detection (simulated) ‚Äî route deviation, inactivity,
                  dropoffs.
                </p>
                <div style="display: flex; gap: 12px; margin-top: 8px">
                  <button class="btn btn-outline" onclick="simulateDeviation()">
                    Simulate Deviation
                  </button>
                  <button class="btn btn-outline" onclick="simulateDropoff()">
                    Simulate Drop-off
                  </button>
                  <button
                    class="btn btn-outline"
                    onclick="simulateInactivity()"
                  >
                    Simulate Inactivity
                  </button>
                </div>
                <div id="analytics-log" style="margin-top: 12px"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      (function () {
        let currentUser = null,
          touristId = null;
        let map,
          authMap,
          safePolyline = null,
          heatLayer = null,
          clusterMarkers = [];
        let userMarker = null,
          familyMarker = null,
          familyInterval = null,
          trackingWatchId = null,
          riskPolygon = null,
          riskZones = [],
          moderateZones = [],
          safeZones = [];
        let activeAlerts = JSON.parse(
          localStorage.getItem("tripguard_alerts") || "[]",
        );
        let feedbackList = JSON.parse(
          localStorage.getItem("tripguard_feedback") || "[]",
        );
        let safetyScore = 80,
          plannedRoute = null,
          uiLanguage = "en",
          speechRec = null;
        let lastPosition = null,
          stationaryStartTime = null,
          inactivityTimer = null,
          ratingValue = 0;

        const policeStations = [
          { name: "Guwahati Police Control", phone: "+91 361-252-1242", pos: { lat: 26.1783, lng: 91.745 } },
          { name: "Shillong Police HQ", phone: "+91 364-222-2277", pos: { lat: 25.5788, lng: 91.8933 } },
          { name: "Itanagar Police", phone: "+91 360-221-2262", pos: { lat: 27.0844, lng: 93.6053 } },
        ];
        const hospitals = [
          { name: "Guwahati Medical College", pos: { lat: 26.1852, lng: 91.7732 } },
          { name: "NEIGRIHMS Shillong", pos: { lat: 25.613, lng: 91.9387 } },
          { name: "TRIHMS Naharlagun", pos: { lat: 27.1103, lng: 93.686 } },
        ];

        const TTS_PHRASES = {
          en: {
            enteredRisk: "Warning: you have entered a high risk zone",
            offRoute: "Warning: you are off the planned route",
            stillness:
              "You have been stationary for a while. If this is an emergency, press the panic button.",
          },
          hi: {
            enteredRisk:
              "‡§ö‡•á‡§§‡§æ‡§µ‡§®‡•Ä: ‡§Ü‡§™ ‡§â‡§ö‡•ç‡§ö ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§µ‡§æ‡§≤ÔøΩÔøΩÔøΩ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§Æ‡•á‡§Ç ‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§ï‡§∞ ‡§ó‡§è ‡§π‡•à‡§Ç",
            offRoute: "‡§ö‡•á‡§§‡§æ‡§µ‡§®‡•Ä: ‡§Ü‡§™ ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§∏‡•á ‡§¨‡§æ‡§π‡§∞ ‡§π‡•à‡§Ç",
            stillness:
              "‡§Ü‡§™ ‡§ï‡•Å‡§õ ‡§∏‡§Æ‡§Ø ‡§∏‡•á ‡§è‡§ï ‡§π‡•Ä ‡§∏‡•ç‡§•‡§æ‡§® ‡§™‡§∞ ‡§π‡•à‡§Ç‡•§ ‡§Ø‡§¶‡§ø ‡§Ø‡§π ‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤ ‡§π‡•à, ‡§§‡•ã ‡§™‡•à‡§®‡§ø‡§ï ‡§¨‡§ü‡§® ‡§¶‡§¨‡§æ‡§è‡§Å‡•§",
          },
          bn: {
            enteredRisk: "‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ: ‡¶Ü‡¶™‡¶®‡¶ø ‡¶â‡¶ö‡ßç‡¶ö ‡¶ùÔøΩÔøΩ‡¶Å‡¶ï‡¶ø‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶è‡¶≤‡¶æ‡¶ï‡¶æ‡¶Ø‡¶º ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®",
            offRoute: "‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ: ‡¶Ü‡¶™‡¶®‡¶ø ‡¶™‡¶∞ÔøΩÔøΩÔøΩ‡¶ï‡¶≤‡ßç‡¶™‡¶ø‡¶§ ‡¶∞‡ßÅ‡¶ü ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡¶ø‡¶ö‡ßç‡¶Ø‡ßÅ‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶®",
            stillness:
              "‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø‡¶õ‡ßÅ‡¶ï‡ßç‡¶∑‡¶£ ‡¶ß‡¶∞‡ßá ‡¶è‡¶ï‡¶á ‡¶ú‡¶æ‡¶Ø‡¶º‡¶ó‡¶æ‡¶Ø‡¶º ‡¶Ü‡¶õ‡ßá‡¶®‡•§ ‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ ‡¶π‡¶≤‡ßá ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶ï ‡¶¨‡ßã‡¶§‡¶æ‡¶Æ ‡¶ö‡¶æ‡¶™‡ßÅ‡¶®‡•§",
          },
          mr: {
            enteredRisk: "‡§∏‡§æ‡§µ‡§ß‡§æ‡§®: ‡§Ü‡§™‡§£ ‡§â‡§ö‡•ç‡§ö ‡§ß‡•ã‡§ï‡§æ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞‡§æ‡§§ ‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§ï‡•á‡§≤‡§æ ‡§Ü‡§π‡•á",
            offRoute: "‡§∏‡§æ‡§µ‡§ß‡§æ‡§®: ‡§Ü‡§™‡§£ ‡§®‡§ø‡§Ø‡•ã‡§ú‡§ø‡§§ ‡§Æ‡§æ‡§∞‡•ç‡§ó‡§æ‡§µ‡§∞‡•Ç‡§® ‡§¨‡§æ‡§π‡•á‡§∞ ‡§Ü‡§≤ÔøΩÔøΩÔøΩ ‡§Ü‡§π‡§æ‡§§",
            stillness:
              "‡§Ü‡§™‡§£ ‡§ï‡§æ‡§π‡•Ä ‡§ï‡§æ‡§≥ ‡§è‡§ï‡§æ‡§ö ‡§†‡§ø‡§ï‡§æ‡§£‡•Ä ‡§Ü‡§π‡§æ‡§§. ‡§Ü‡§£‡•Ä‡§¨‡§æ‡§£‡•Ä ÔøΩÔøΩ‡§∏‡§≤‡•ç‡§Ø‡§æ‡§∏ ‡§™‡•Ö‡§®‡§ø‡§ï ‡§¨‡§ü‡§£ ‡§¶‡§æ‡§¨‡§æ.",
          },
          te: {
            enteredRisk: "‡∞π‡±Ü‡∞ö‡±ç‡∞ö‡∞∞‡∞ø‡∞ï: ‡∞Æ‡±Ä‡∞∞‡±Å ‡∞Ö‡∞ß‡∞ø‡∞ï ‡∞™‡±ç‡∞∞‡∞Æ‡∞æ‡∞¶ ‡∞™‡±ç‡∞∞‡∞æ‡∞Ç‡∞§‡∞Ç‡∞≤‡±ã‡∞ï‡∞ø ‡∞™‡±ç‡∞∞‡∞µ‡±á‡∞∂‡∞ø‡∞Ç‡∞ö‡∞æ‡∞∞‡±Å",
            offRoute: "‡∞π‡±Ü‡∞ö‡±ç‡∞ö‡∞∞‡∞ø‡∞ï: ‡∞Æ‡±Ä‡∞∞‡±Å ‡∞™‡±ç‡∞∞‡∞£‡∞æ‡∞≥‡∞ø‡∞ï ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ó‡∞Ç ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‡∞¶‡±Ç‡∞∞‡∞Æ‡∞Ø‡±ç‡∞Ø‡∞æ‡∞∞‡±Å",
            stillness:
              "‡∞Æ‡±Ä‡∞∞‡±Å ‡∞ï‡±ä‡∞Ç‡∞§‡∞ï‡∞æ‡∞≤‡∞Ç‡∞ó‡∞æ ‡∞í‡∞ï‡±á ‡∞öÔøΩÔøΩ‡∞ü ‡∞â‡∞®‡±ç‡∞®‡∞æ‡∞∞‡±Å. ‡∞Ö‡∞§‡±ç‡∞Ø‡∞µ‡∞∏‡∞∞‡∞Ç ‡∞Ö‡∞ØÔøΩÔøΩÔøΩ‡∞§‡±á ‡∞™‡∞æ‡∞®‡∞ø‡∞ï‡±ç ‡∞¨‡∞üÔøΩÔøΩÔøΩ‡±ç ‡∞®‡±ä‡∞ï‡±ç‡∞ï‡∞Ç‡∞°‡∞ø.",
          },
          ta: {
            enteredRisk:
              "‡Æé‡Æö‡Øç‡Æö‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Øà: ‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÖ‡Æ§‡Æø‡Æï ‡ÆÜ‡Æ™‡Æ§‡Øç‡Æ§‡ØÅ ‡Æ®‡Æø‡Æ±‡Øà‡Æ®‡Øç‡Æ§ ‡Æ™‡Æï‡ØÅ‡Æ§‡Æø‡ÆØ‡Æø‡Æ≤‡Øç ‡Æ®‡ØÅ‡Æ¥‡Øà‡Æ®‡Øç‡Æ§‡ØÅ‡Æµ‡Æø‡Æü‡Øç‡Æü‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç",
            offRoute: "‡Æé‡Æö‡Øç‡Æö‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Øà: ‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ§‡Æø‡Æü‡Øç‡Æü‡ÆÆ‡Æø‡Æü‡Øç‡Æü ‡Æ™‡Ææ‡Æ§‡Øà‡ÆØ‡Æø‡Æ≤‡Øç ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà",
            stillness:
              "‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æö‡Æø‡Æ≤ ‡Æ®‡Øá‡Æ∞‡ÆÆ‡Ææ‡Æï ‡Æí‡Æ∞‡Øá ‡Æá‡Æü‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡Æá‡Æ∞‡ØÅ‡Æï‡ØçÔøΩÔøΩ‡Æø‡Æ±‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç. ‡ÆÖ‡Æµ‡Æö‡Æ∞‡ÆÆ‡Øç ‡Æé‡Æ©‡Øç‡Æ±‡Ææ‡Æ≤‡Øç ‡Æ™‡ØÄ‡Æ§‡Æø ‡Æ™‡Øä‡Æ§‡Øç‡Æ§‡Ææ‡Æ©‡Øà ‡ÆÖ‡Æ¥‡ØÅ‡Æ§‡Øç‡Æ§‡Æµ‡ØÅ‡ÆÆ‡Øç.",
          },
          kn: {
            enteredRisk:
              "‡≤é‡≤ö‡≥ç‡≤ö‡≤∞‡≤ø‡≤ï‡≥Ü: ‡≤®‡≥Ä‡≤µ‡≥Å ‡≤π‡≥Ü‡≤ö‡≥çÔøΩÔøΩÔøΩ‡≤ø‡≤® ‡≤Ö‡≤™‡≤æ‡≤Ø‡≤¶ ‡≤µ‡≤≤‡≤Ø‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤™‡≥ç‡≤∞‡≤µ‡≥á‡≤∂‡≤ø‡≤∏‡≤ø‡≤¶‡≥ç‡≤¶‡≥Ä‡≤∞‡≤ø",
            offRoute: "‡≤é‡≤ö‡≥ç‡≤ö‡≤∞‡≤ø‡≤ï‡≥Ü: ‡≤®‡≥Ä‡≤µ‡≥Å ‡≤Ø‡≥ã‡≤ú‡≤ø‡≤§ ‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ó‡≤¶‡≤ø‡≤Ç‡≤¶ ‡≤¶‡≥Ç‡≤∞ ‡≤∏‡≤∞‡≤ø‡≤¶‡≤ø‡≤¶‡≥ç‡≤¶‡≥Ä‡≤∞‡≤ø",
            stillness:
              "‡≤®‡≤ø‡≥ï‡≤µ‡≥Å ‡≤ï‡≥Ü‡≤≤‡≤µ‡≥Å ‡≤∏‡≤Æ‡≤Ø‡≤¶‡≤ø‡≤Ç‡≤¶ ‡≤í‡≤Ç‡≤¶ÔøΩÔøΩÔøΩ‡≥ï ‡≤∏‡≥ç‡≤•‡≤≥‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø‡≤¶‡≥ç‡≤¶‡≤ø‡≥ï‡≤∞‡≤ø. ‡≤§‡≥Å‡≤∞‡≥ç‡≤§‡≥Å ‡≤™‡≤∞‡≤ø‡≤∏‡≥ç‡≤•‡≤ø‡≤§‡≤ø‡≤Ø‡≤ø‡≤¶‡≥çÔøΩÔøΩ‡≤∞‡≥Ü ‡≤™‡≥ç‡≤Ø‡≤æ‡≤®‡≤ø‡≤ï‡≥ç ‡≤¨‡≤ü‡≤®‡≥ç ‡≤í‡≤§‡≥ç‡≤§‡≤ø‡≤∞‡≤ø.",
          },
          ml: {
            enteredRisk:
              "ÔøΩÔøΩ‡µÅ‡¥®‡µç‡¥®‡¥±‡¥ø‡¥Ø‡¥ø‡¥™‡µç‡¥™‡µç: ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡µæ ‡¥â‡¥Ø‡µº‡¥®‡µçÔøΩÔøΩ ‡¥Ö‡¥™‡¥ï‡¥ü ‡¥∏‡¥æ‡¥ß‡µç‡¥Ø‡¥§‡¥Ø‡µÅ‡¥≥‡µç‡¥≥ ‡¥Æ‡µá‡¥ñ‡¥≤‡¥Ø‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç ‡¥™‡µç‡¥∞‡¥µ‡µá‡¥∂‡¥ø‡¥ö‡µç‡¥ö‡µÅ",
            offRoute:
              "‡¥Æ‡µÅ‡¥®‡µç‡¥®‡¥±‡¥ø‡¥Ø‡¥ø‡¥™‡µç‡¥™‡µç: j≈´s ‡¥™‡¥¶‡µç‡¥ß‡¥ölei√∞‡¥Ø‡¥ø‡µΩ ‡¥®‡¥ø‡¥®‡µç‡¥®‡µç ‡¥µ‡µç‡¥Ø‡¥§‡¥ø‡¥ö‡¥≤‡¥ø‡¥ö‡µç‡¥ö‡¥ø‡¥∞ÔøΩÔøΩÔøΩ‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ",
            stillness:
              "‡¥®‡¥ø‡¥ô‡µç‡¥ô‡µæ ‡¥ï‡µÅ‡¥±‡¥ö‡µç‡¥ö‡µç ‡¥∏‡¥Æ‡¥Ø‡¥Æ‡¥æ‡¥Ø‡¥ø ‡¥í‡¥∞‡µá ‡¥∏‡µç‡¥•‡¥≤‡¥§‡µç‡¥§‡¥æ‡¥£‡µç. ‡¥Ö‡¥ü‡¥ø‡¥Ø‡¥®‡µç‡¥§‡¥ø‡¥∞ ‡¥∏‡µç‡¥•‡¥ø‡¥§‡¥ø‡¥Ø‡¥æ‡¥£‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥™‡¥æ‡¥®‡¥ø‡¥ï‡µç ‡¥¨‡¥ü‡µç‡¥ü‡µ∫ ‡¥Ö‡¥Æ‡µº‡¥§‡µç‡¥§‡µÅ‡¥ï.",
          },
          gu: {
            enteredRisk: "‡™ö‡´á‡™§‡™µ‡™£‡´Ä: ‡™§‡™Æ‡´á ‡™â‡™ö‡´ç‡™ö ‡™ú‡´ã‡™ñ‡™Æ‡™µ‡™æ‡™≥‡™æ ‡™µ‡™ø‡™∏‡´ç‡™§‡™æ‡™∞‡™Æ‡™æ‡™Ç ‡™¶‡™æ‡™ñ‡™≤ ‡™•‡™Ø‡™æ ‡™õ‡´ã",
            offRoute: "‡™ö‡´á‡™§‡™µ‡™£‡´Ä: ‡™§‡™Æ‡´á ‡™Ü‡™Ø‡´ã‡™ú‡™®‡™¨‡™¶‡´ç‡™ß ‡™Æ‡™æ‡™∞‡´ç‡™ó‡™•‡´Ä ‡™≠‡™ü‡™ï‡´Ä ‡™ó‡™Ø‡™æ ‡™õ‡´ã",
            stillness:
              "‡™§‡™Æ‡´á ÔøΩÔøΩÔøΩ‡´ã‡™°‡™æ ‡™∏‡™Æ‡™Ø‡™•‡´Ä ‡™è‡™ï ‡™ú ‡™∏‡´ç‡™•‡™≥‡´á ‡™õ‡´ã. ‡™§‡™æ‡™§‡´ç‡™ï‡™æ‡™≤‡™ø‡™ï ‡™∏‡´ç‡™•‡™ø‡™§‡™ø ‡™π‡´ã‡™Ø ÔøΩÔøΩÔøΩ‡´ã ‡™™‡´á‡™®‡™ø‡™ï ‡™¨‡™ü‡™® ‡™¶‡™¨‡™æ‡™µ‡´ã.",
          },
          pa: {
            enteredRisk: "‡®ö‡©á‡®§‡®æ‡®µ‡®®‡©Ä: ÔøΩÔøΩ‡©Å‡®∏‡©Ä‡®Ç ‡®â‡©±‡®ö-‡®ñ‡®§‡®∞‡©á ‡®µ‡®æ‡®≤‡©á ‡®ñ‡©á‡®§‡®∞ ‡®µ‡®ø‡©±‡®ö ‡®¶‡®æ‡®ñ‡®≤ ‡®π‡©ã ‡®ó‡®è ‡®π‡©ã",
            offRoute: "‡®ö‡©á‡®§‡®æ‡®µ‡®®‡©Ä: ‡®§‡©Å‡®∏‡©Ä‡®Ç ‡®Ø‡©ã‡®ú‡®®‡®æ‡®¨‡©±‡®ß ‡®Æ‡®æ‡®∞‡®ó ‡®§‡©ã‡®Ç ‡®≠‡®ü‡®ï ‡®ó‡®è ‡®π‡©ã",
            stillness:
              "‡®§‡©Å‡®∏‡©Ä‡®Ç ‡®ï‡©Å‡®ù ‡®∏‡®Æ‡©á‡®Ç ‡®§‡©ã‡®Ç ‡®á‡©±‡®ï‡©á ‡®•‡®æ‡®Ç '‡®§‡©á ‡®π‡©ã‡•§ ‡®ú‡©á ‡®ê‡®Æ‡®∞‡®ú‡©à‡®Ç‡®∏‡©Ä ‡®π‡©à ‡®§‡®æ‡®Ç ‡®™‡©à‡®®‡®ø‡®ï ‡®¨‡®ü‡®® ‡®¶‡®¨‡®æ‡®ì‡•§",
          },
          or: {
            enteredRisk: "‡¨ö‡≠á‡¨§‡¨æ‡¨¨‡¨®‡≠Ä: ‡¨Ü‡¨™‡¨£ ‡¨â‡¨ö‡≠ç‡¨ö ‡¨¨‡¨ø‡¨™‡¨¶ ‡¨Ö‡¨û‡≠ç‡¨ö‡¨≥‡¨∞‡≠á ‡¨™‡≠ç‡¨∞‡¨¨‡≠á‡¨∂ ‡¨ï‡¨∞‡¨ø‡¨õ‡¨®‡≠ç‡¨§‡¨ø",
            offRoute: "‡¨ö‡≠á‡¨§‡¨æ‡¨¨‡¨®‡≠Ä: ‡¨Ü‡¨™ÔøΩÔøΩ ‡¨Ø‡≠ã‡¨ú‡¨ø‡¨§ ‡¨Æ‡¨æ‡¨∞‡≠ç‡¨ó‡¨∞‡≠Å ‡¨¨‡¨ø‡¨ö‡≠ç‡≠ü‡≠Å‡¨§ ‡¨π‡≠ã‡¨á‡¨õ‡¨®‡≠ç‡¨§‡¨ø",
            stillness:
              "‡¨Ü‡¨™‡¨£ ‡¨ï‡¨ø‡¨õ‡¨ø ‡¨∏‡¨Æ‡≠ü ‡¨ß‡¨∞‡¨ø ‡¨ó‡≠ã‡¨ü‡¨ø‡¨è ‡¨∏‡≠ç‡¨•‡¨æ‡¨®‡¨∞‡≠á ‡¨Ö‡¨õ‡¨®‡≠ç‡¨§‡¨ø‡•§ ‡¨Ø‡¨¶‡¨ø ‡¨Ü‡¨™‡¨§‡≠ç‡¨ï‡¨æ‡¨≥ ‡¨Ö‡¨õ‡¨ø, ‡¨™‡≠ç‡≠ü‡¨æ‡¨®‡¨ø‡¨ï‡≠ç ‡¨¨‡¨ü‡¨®‡≠ç ‡¨¶‡¨¨‡¨æ‡¨®‡≠ç‡¨§‡≠Å‡•§",
          },
          as: {
            enteredRisk: "‡¶∏‡¶§‡ß∞‡ßç‡¶ï‡¶§‡¶æ: ‡¶Ü‡¶™‡ßÅ‡¶®‡¶ø ‡¶â‡¶ö‡ßç‡¶ö ‡¶¨‡¶ø‡¶™‡¶¶‡¶∏‡¶Ç‡¶ï‡ßÅ‡¶≤ ‡¶Ö‡¶ûÔøΩÔøΩ‡¶ö‡¶≤‡¶§ ‡¶™‡ßç‡ß∞‡ß±‡ßá‡¶∂ ‡¶ï‡ß∞‡¶ø‡¶õ‡ßá",
            offRoute: "‡¶∏‡¶§‡ß∞‡ßç‡¶ï‡¶§‡¶æ: ‡¶Ü‡¶™‡ßÅÔøΩÔøΩÔøΩ‡¶ø ‡¶™‡ß∞‡¶øÔøΩÔøΩ‡¶≤‡ßç‡¶™‡¶ø‡¶§ ‡¶™‡¶•‡ß∞ ‡¶™‡ß∞‡¶æ ‡¶¨‡¶ø‡¶ö‡ßç‡¶Ø‡ßÅ‡¶§ ‡¶π‡ßà‡¶õ‡ßá",
            stillness:
              "‡¶Ü‡¶™‡ßÅ‡¶®‡¶ø ‡¶Ö‡¶≤‡¶™ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶ß‡ß∞‡¶ø ‡¶è‡¶ï‡ßá ‡¶†‡¶æ‡¶á‡¶§ ‡¶Ü‡¶õ‡ßá‡•§ ‡¶ú‡ß∞‡ßÅ‡ß∞‡ßÄ ‡¶π'‡¶≤‡ßá ‡¶™‡ßá‡¶®‡¶ø‡¶ï ‡¶¨‡ßÅ‡¶ü‡¶æ‡¶Æ ‡¶ü‡¶ø‡¶™‡¶ï‡•§",
          },
        };

        const $ = (s) => document.querySelector(s);
        function uuidv4() {
          return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(
            /[xy]/g,
            (c) => {
              const r = (Math.random() * 16) | 0,
                v = c === "x" ? r : (r & 0x3) | 0x8;
              return v.toString(16);
            },
          );
        }
        function speak(msg) {
          try {
            if (!msg) return;
            const u = new SpeechSynthesisUtterance(msg);
            u.lang = uiLanguage;
            speechSynthesis.cancel();
            speechSynthesis.speak(u);
          } catch {}
        }
        function ttsKey(k) {
          const m = TTS_PHRASES[uiLanguage] || TTS_PHRASES.en;
          return m[k] || "";
        }
        function saveAlerts() {
          localStorage.setItem(
            "tripguard_alerts",
            JSON.stringify(activeAlerts),
          );
          renderAlerts();
        }
        function saveFeedbackList() {
          localStorage.setItem(
            "tripguard_feedback",
            JSON.stringify(feedbackList),
          );
        }
        function addAlert(obj) {
          activeAlerts.unshift(obj);
          saveAlerts();
          updateCounts();
          if (obj.type === "Panic" || obj.priority === "High") {
            notify(`üö® ${obj.name || obj.touristId} ‚Äî ${obj.type}`);
          }
        }
        function notify(msg) {
          if ("Notification" in window) {
            if (Notification.permission === "granted")
              new Notification("TripGuard Alert", { body: msg });
            else if (Notification.permission === "default")
              Notification.requestPermission();
          }
        }
        function updateCounts() {
          $("#alert-count-display").textContent =
            activeAlerts.length + " Active Alerts";
          $("#authority-count").textContent = activeAlerts.length;
          $("#authority-alert-count").textContent = activeAlerts.length;
        }

        function handleGeoError(err) {
          let msg = "Unable to access location.";
          if (err && typeof err.code === "number") {
            if (err.code === 1)
              msg =
                "Location permission denied. Enable location to use live features.";
            else if (err.code === 2)
              msg = "Location unavailable. Try again later.";
            else if (err.code === 3) msg = "Location request timed out.";
          }
          console.warn(
            "Geolocation error:",
            err && err.message ? err.message : err,
          );
          if (!document.querySelector(".geo-toast")) {
            const d = document.createElement("div");
            d.className = "geo-toast";
            d.style.cssText =
              "position:fixed;left:50%;transform:translateX(-50%);bottom:14px;background:#fff;border:1px solid #eee;border-radius:8px;padding:8px 12px;box-shadow:0 2px 10px rgba(0,0,0,.08);z-index:9999;font-size:13px;color:#1e293b";
            d.textContent = msg;
            document.body.appendChild(d);
            setTimeout(() => d.remove(), 3500);
          }
        }

        // Init maps with Leaflet
        function initMaps() {
          const center = [26.1445, 91.7362]; // Guwahati
          map = L.map("map").setView(center, 8);
          L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            maxZoom: 19,
            attribution: "&copy; OpenStreetMap",
          }).addTo(map);
          // Focus on North-East India
          map.fitBounds([
            [21.0, 88.0],
            [29.8, 97.5],
          ]);

          authMap = L.map("auth-map").setView(center, 7);
          L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            maxZoom: 19,
          }).addTo(authMap);

          userMarker = L.circleMarker(center, {
            radius: 8,
            color: "#ffffff",
            weight: 2,
            fillColor: "#2563eb",
            fillOpacity: 1,
          }).addTo(map);
          familyMarker = L.circleMarker(center, {
            radius: 7,
            color: "#ffffff",
            weight: 2,
            fillColor: "#f59e0b",
            fillOpacity: 1,
          });

          // Zones
          riskZones = [
            L.polygon(
              [
                [25.56, 91.85],
                [25.61, 91.92],
                [25.58, 92.0],
                [25.52, 91.94],
              ],
              {
                color: "#ef4444",
                weight: 2,
                fillColor: "#ef4444",
                fillOpacity: 0.18,
              },
            ).addTo(map), // near Shillong
            L.polygon(
              [
                [26.8, 94.1],
                [26.85, 94.18],
                [26.78, 94.26],
                [26.72, 94.18],
              ],
              {
                color: "#ef4444",
                weight: 2,
                fillColor: "#ef4444",
                fillOpacity: 0.18,
              },
            ).addTo(map), // Upper Assam
          ];
          moderateZones = [
            L.circle([26.1445, 91.7362], {
              radius: 4000,
              color: "#f59e0b",
              fillColor: "#f59e0b",
              fillOpacity: 0.18,
              weight: 2,
            }).addTo(map),
            L.circle([27.5, 95.0], {
              radius: 5000,
              color: "#f59e0b",
              fillColor: "#f59e0b",
              fillOpacity: 0.18,
              weight: 2,
            }).addTo(map),
          ];

          // POIs and safe zones around them
          policeStations.forEach((p) => {
            L.circleMarker([p.pos.lat, p.pos.lng], {
              radius: 7,
              fillColor: "#ffcc00",
              color: "#663",
              weight: 1,
              fillOpacity: 1,
            })
              .addTo(map)
              .bindTooltip(p.name);
            safeZones.push(
              L.circle([p.pos.lat, p.pos.lng], {
                radius: 1500,
                color: "#22c55e",
                fillColor: "#22c55e",
                fillOpacity: 0.12,
                weight: 1,
              }).addTo(map),
            );
          });
          hospitals.forEach((h) => {
            L.circleMarker([h.pos.lat, h.pos.lng], {
              radius: 7,
              fillColor: "#22c55e",
              color: "#164",
              weight: 1,
              fillOpacity: 1,
            })
              .addTo(map)
              .bindTooltip(h.name);
            safeZones.push(
              L.circle([h.pos.lat, h.pos.lng], {
                radius: 1500,
                color: "#22c55e",
                fillColor: "#22c55e",
                fillOpacity: 0.12,
                weight: 1,
              }).addTo(map),
            );
          });

          // Single legacy polygon kept for computations fallback
          riskPolygon = riskZones[0];

          // Legend
          const legend = L.control({ position: "bottomright" });
          legend.onAdd = function () {
            const div = L.DomUtil.create("div", "legend");
            div.innerHTML = `<style>.legend{background:#fff;padding:8px 10px;border:1px solid #eee;border-radius:8px;font-size:12px}.legend .row{display:flex;align-items:center;gap:6px;margin:4px 0}.dot{width:10px;height:10px;border-radius:50%}</style><div class='legend'><div class='row'><span class='dot' style='background:#22c55e'></span>Safe zone</div><div class='row'><span class='dot' style='background:#f59e0b'></span>Moderate zone</div><div class='row'><span class='dot' style='background:#ef4444'></span>Risk zone</div></div>`;
            return div;
          };
          legend.addTo(map);

          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
              (pos) => {
                const ll = [pos.coords.latitude, pos.coords.longitude];
                userMarker.setLatLng(ll);
                map.setView(ll, 12);
                updateUserLocationUI({ lat: ll[0], lng: ll[1] });
              },
              handleGeoError,
              { enableHighAccuracy: true, timeout: 15000, maximumAge: 0 },
            );
          }

          generateAuthClusters();
          renderAlerts();
          updateCounts();
        }

        function visualizeUserOnAuthority(p) {
          if (!authMap) return;
          const m = L.circleMarker([p.lat, p.lng], {
            radius: 6,
            fillColor: "#00bcd4",
            fillOpacity: 0.9,
            color: "#fff",
            weight: 1,
          }).addTo(authMap);
          clusterMarkers.push(m);
        }
        function visualizeAnomalyOnAuthority(a) {
          if (!authMap || !a.location) return;
          const [la, ln] = a.location.split(",").map(Number);
          if (isNaN(la) || isNaN(ln)) return;
          const ring = L.circle([la, ln], {
            radius: 400,
            color: "#ef4444",
            fillOpacity: 0.1,
            weight: 2,
          });
          ring.addTo(authMap);
          setTimeout(() => authMap.removeLayer(ring), 10000);
        }
        function generateAuthClusters() {
          const list = $("#cluster-list");
          list.innerHTML = "";
          clusterMarkers.forEach((m) => authMap.removeLayer(m));
          clusterMarkers = [];
          if (heatLayer) {
            authMap.removeLayer(heatLayer);
            heatLayer = null;
          }
          const bounds = [
            [21.0, 88.0],
            [29.8, 97.5],
          ];
          const pts = [];
          for (let i = 0; i < 80; i++) {
            const lat =
              bounds[0][0] + Math.random() * (bounds[1][0] - bounds[0][0]);
            const lng =
              bounds[0][1] + Math.random() * (bounds[1][1] - bounds[0][1]);
            pts.push([lat, lng, 0.3 + Math.random() * 0.7]);
            const m = L.circleMarker([lat, lng], {
              radius: 4,
              fillColor: "#2563eb",
              fillOpacity: 0.8,
              color: "#fff",
              weight: 0.5,
            }).addTo(authMap);
            clusterMarkers.push(m);
          }
          activeAlerts.forEach((a) => {
            if (a.location) {
              const [la, ln] = a.location.split(",").map(Number);
              if (!isNaN(la) && !isNaN(ln)) pts.push([la, ln, 1.0]);
            }
          });
          heatLayer = L.heatLayer(pts, {
            radius: 25,
            blur: 30,
            maxZoom: 12,
          }).addTo(authMap);
          const buckets = { Low: 0, Medium: 0, High: 0 };
          clusterMarkers.forEach(() => {
            const r = Math.random();
            if (r < 0.6) buckets.Low++;
            else if (r < 0.9) buckets.Medium++;
            else buckets.High++;
          });
          Object.entries(buckets).forEach(([risk, count]) => {
            const color =
              risk === "High"
                ? "#ef4444"
                : risk === "Medium"
                  ? "#f59e0b"
                  : "#22c55e";
            const el = document.createElement("div");
            el.className = "cluster-marker";
            el.style.backgroundColor = color;
            el.innerHTML = `<i class="fas fa-users"></i> ${count} tourists (${risk} risk)`;
            list.appendChild(el);
          });
        }

        // Auth
        window.login = function () {
          const role = document.getElementById('role-select').value;
          const email = $("#email").value;
          const password = $("#password").value;
          
          // Debug: check what values we're getting
          console.log("Email:", email);
          console.log("Password:", password);
          console.log("Password length:", password.length);
          
          if (!email || !password) {
              alert("Please enter both email and password\nEmail: " + email + "\nPassword: " + password);
              return;
          }
          if (role === 'tourist') {
            const idType = (document.getElementById('id-type').value || 'aadhar');
            if (idType === 'aadhar') {
              const aadhar = (document.getElementById('aadhar').value || '').trim();
              if (!/^\d{12}$/.test(aadhar)) { alert('Enter valid 12-digit Aadhar'); return; }
              currentUser = { email, name: email.split("@")[0], type: "tourist", identityType: 'aadhar', aadhar };
              touristId = `TOUR-${aadhar.slice(-6)}-${uuidv4().slice(0,4).toUpperCase()}`;
            } else {
              const passportRaw = (document.getElementById('passport').value || '').trim().toUpperCase();
              if (!/^[A-Z][0-9]{7}$/.test(passportRaw)) { alert('Enter valid Passport (e.g., A1234567)'); return; }
              currentUser = { email, name: email.split("@")[0], type: "tourist", identityType: 'passport', passport: passportRaw };
              const suffix = passportRaw.slice(-4);
              touristId = `TOUR-${suffix}-${uuidv4().slice(0,4).toUpperCase()}`;
            }
            $("#login-screen").classList.add("hidden");
            $("#app-container").classList.remove("hidden");
            $("#user-info").textContent = currentUser.email;
            $("#tourist-name").textContent = currentUser.name;
            $("#tourist-id").textContent = "ID: " + touristId;
            $("#safety-score").textContent = safetyScore;
            $("#header-safety").textContent = "Safety Score: " + safetyScore;
            initMaps();
            startTracking();
            if ("Notification" in window && Notification.permission === "default") {
              Notification.requestPermission();
            }
          } else {
            const authId = (document.getElementById('authority-id').value || '').trim();
            if (!authId) { alert('Enter Authority ID'); return; }
            currentUser = { email, name: `Authority ${authId}`, type: "authority", authId };
            $("#login-screen").classList.add("hidden");
            $("#app-container").classList.remove("hidden");
            $("#user-info").textContent = currentUser.email;
            // Default to authority dashboard after login
            switchTab(null, 'authority');
            initMaps();
          }
        };
        window.register = function () {
          const email = $("#email").value,
            password = $("#password").value;
          if (!email || !password) {
            alert("Please enter both email and password");
            return;
          }
          alert("Registration successful! You can now login.");
        };
        window.loginAsAuthority = function () {
          const roleSel = document.getElementById('role-select');
          const t = document.getElementById('tourist-kyc');
          const a = document.getElementById('authority-fields');
          roleSel.value = 'authority'; t.style.display = 'none'; a.style.display = 'block';
        };
        window.logout = function () {
          if (trackingWatchId)
            navigator.geolocation.clearWatch(trackingWatchId);
          if (familyInterval) clearInterval(familyInterval);
          if (inactivityTimer) clearInterval(inactivityTimer);
          currentUser = null;
          touristId = null;
          $("#app-container").classList.add("hidden");
          $("#login-screen").classList.remove("hidden");
        };

        // Geolocation watch
        function startTracking() {
          if (!navigator.geolocation) {
            alert("Geolocation not supported");
            return;
          }
          trackingWatchId = navigator.geolocation.watchPosition(
            (p) => {
              const pos = { lat: p.coords.latitude, lng: p.coords.longitude };
              updateUserLocationUI(pos);
            },
            handleGeoError,
            { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 },
          );
          startInactivityMonitoring();
        }
        function updateUserLocationUI(pos) {
          const ll = [pos.lat, pos.lng];
          if (userMarker) userMarker.setLatLng(ll);
          if (map) map.setView(ll);
          checkGeofence(pos);
          if (plannedRoute) checkRouteDeviation(pos);
          resetInactivityTimer();
          visualizeUserOnAuthority(pos);
        }

        // Geofence (polygon)
        function pointInPolygon(point, vs) {
          // ray-casting
          const x = point.lng,
            y = point.lat;
          let inside = false;
          for (let i = 0, j = vs.length - 1; i < vs.length; j = i++) {
            const xi = vs[i][1],
              yi = vs[i][0];
            const xj = vs[j][1],
              yj = vs[j][0];
            const intersect =
              yi > y != yj > y && x < ((xj - xi) * (y - yi)) / (yj - yi) + xi;
            if (intersect) inside = !inside;
          }
          return inside;
        }
        function isInsideCircle(p, circle) {
          const c = circle.getLatLng();
          const r = circle.getRadius();
          return haversine(p, { lat: c.lat, lng: c.lng }) <= r;
        }
        function isInsidePolygon(p, poly) {
          const coords = poly.getLatLngs()[0].map((ll) => [ll.lat, ll.lng]);
          return pointInPolygon(p, coords);
        }
        function inAny(layers, p) {
          for (const l of layers) {
            if (l.getRadius) {
              if (isInsideCircle(p, l)) return true;
            } else if (l.getLatLngs) {
              if (isInsidePolygon(p, l)) return true;
            }
          }
          return false;
        }
        function centroidOfPolygon(poly) {
          const pts = poly.getLatLngs()[0];
          let lat = 0,
            lng = 0;
          pts.forEach((pt) => {
            lat += pt.lat;
            lng += pt.lng;
          });
          return { lat: lat / pts.length, lng: lng / pts.length };
        }
        function checkGeofence(p) {
          if (inAny(riskZones, p)) {
            const a = {
              id: uuidv4(),
              touristId,
              name: currentUser?.name,
              type: "Entered Risk Zone",
              location: `${p.lat.toFixed(6)},${p.lng.toFixed(6)}`,
              time: new Date().toLocaleString(),
              priority: "High",
            };
            addAlert(a);
            speak(ttsKey("enteredRisk"));
            notify("You entered a high-risk zone");
            return;
          }
          if (inAny(moderateZones, p)) {
            const a = {
              id: uuidv4(),
              touristId,
              name: currentUser?.name,
              type: "Entered Moderate Zone",
              location: `${p.lat.toFixed(6)},${p.lng.toFixed(6)}`,
              time: new Date().toLocaleString(),
              priority: "Low",
            };
            addAlert(a);
          }
        }

        // Route planning using Nominatim geocoding + straight-line polyline (demo)
        async function geocode(q) {
          if (q === "current" && userMarker) {
            const ll = userMarker.getLatLng();
            return { lat: ll.lat, lng: ll.lng };
          }
          const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}&limit=1`;
          const r = await fetch(url, {
            headers: { "Accept-Language": uiLanguage },
          });
          const j = await r.json();
          if (!j[0]) throw new Error("Location not found: " + q);
          return { lat: parseFloat(j[0].lat), lng: parseFloat(j[0].lon) };
        }
        async function osrmRoute(a, b) {
          const url = `https://router.project-osrm.org/route/v1/foot/${a.lng},${a.lat};${b.lng},${b.lat}?overview=full&geometries=geojson`;
          const r = await fetch(url);
          const j = await r.json();
          if (j.code !== "Ok") throw new Error("Routing failed");
          const coords = j.routes[0].geometry.coordinates.map(([lng, lat]) => ({
            lat,
            lng,
          }));
          return coords;
        }
        async function routeVia(points) {
          let all = [];
          for (let i = 0; i < points.length - 1; i++) {
            const seg = await osrmRoute(points[i], points[i + 1]);
            if (i > 0) seg.shift();
            all = all.concat(seg);
          }
          return all;
        }
        window.openRoutePlanner = async function () {
          try {
            const origin = prompt(
              'Enter origin address or "current"',
              "current",
            );
            if (!origin) return;
            const dest = prompt("Enter destination address", "Shillong");
            if (!dest) return;
            const stopsRaw = prompt(
              "Intermediate stops (semicolon separated, optional)",
              "",
            );
            const stops = (stopsRaw || "")
              .split(";")
              .map((s) => s.trim())
              .filter(Boolean);
            const points = [await geocode(origin)];
            for (const s of stops) {
              points.push(await geocode(s));
            }
            points.push(await geocode(dest));
            const basePath = await routeVia(points);
            const detouredPoints = buildSafeDetour(points);
            const detourPath = await routeVia(detouredPoints);
            const baseScore = computeSafetyScore(basePath);
            const detourScore = computeSafetyScore(detourPath);
            const bestPath = detourScore > baseScore ? detourPath : basePath;
            plannedRoute = bestPath;
            drawSafeRoute(bestPath);
            const bestScore = detourScore > baseScore ? detourScore : baseScore;
            safetyScore = bestScore;
            $("#safety-score").textContent = bestScore;
            $("#header-safety").textContent = "Safety Score: " + bestScore;
            showNearestServicesAlongRoute(bestPath);
          } catch (e) {
            alert("Route error: " + e.message);
          }
        };
        function buildSafeDetour(path) {
          let out = [...path];
          for (const poly of riskZones) {
            const c = centroidOfPolygon(poly); // if line passes near this polygon bbox, insert nearest service as waypoint
            const nearPolice = policeStations.reduce((p, cur) =>
              haversine(c, cur.pos) < haversine(c, p.pos) ? cur : p,
            );
            const nearHospital = hospitals.reduce((p, cur) =>
              haversine(c, cur.pos) < haversine(c, p.pos) ? cur : p,
            );
            const via =
              haversine(path[Math.floor(path.length / 2)], nearPolice.pos) <
              haversine(path[Math.floor(path.length / 2)], nearHospital.pos)
                ? nearPolice.pos
                : nearHospital.pos;
            // insert waypoint in the middle
            const mid = Math.floor(out.length / 2);
            out = [...out.slice(0, mid), via, ...out.slice(mid)];
          }
          return out;
        }
        function drawSafeRoute(path) {
          if (safePolyline) {
            map.removeLayer(safePolyline);
          }
          safePolyline = L.polyline(
            path.map((p) => [p.lat, p.lng]),
            { color: "#3b82f6", weight: 5 },
          ).addTo(map);
          map.fitBounds(safePolyline.getBounds(), { padding: [30, 30] });
        }

        function computeSafetyScore(path) {
          let score = 100; // penalties and bonuses along path
          // risk/moderate
          for (const p of path) {
            if (inAny(riskZones, p)) {
              score -= 40;
              break;
            }
          }
          for (const p of path) {
            if (inAny(moderateZones, p)) {
              score -= 12;
              break;
            }
          }
          // proximity to services
          let total = 0,
            c = 0,
            safeHits = 0;
          for (const p of path.slice(0, Math.min(30, path.length))) {
            const pd = Math.min(
              ...policeStations.map((ps) => haversine(p, ps.pos)),
            );
            const hd = Math.min(...hospitals.map((h) => haversine(p, h.pos)));
            const d = Math.min(pd, hd);
            total += d;
            c++;
            if (inAny(safeZones, p)) safeHits++;
          }
          const avg = c ? total / c : 0;
          if (avg > 1500) score -= 25;
          else score -= Math.round((avg / 1500) * 15);
          // bonus if within safe zones for many points
          if (safeHits >= c / 3) score += 10;
          return Math.max(20, Math.min(100, Math.round(score)));
        }
        function haversine(a, b) {
          const R = 6371000;
          const toRad = Math.PI / 180;
          const dLat = (a.lat - b.lat) * toRad,
            dLon = (a.lng - b.lng) * toRad;
          const la = a.lat * toRad,
            lb = b.lat * toRad;
          const sa =
            Math.sin(dLat / 2) ** 2 +
            Math.cos(la) * Math.cos(lb) * Math.sin(dLon / 2) ** 2;
          const c = 2 * Math.atan2(Math.sqrt(sa), Math.sqrt(1 - sa));
          return R * c;
        }
        function showNearestServicesAlongRoute(path) {
          if (!path.length) return;
          const step = Math.max(1, Math.floor(path.length / 10));
          const sample = path.filter((_, i) => i % step === 0);
          const seen = new Set();
          sample.forEach((pt) => {
            const key =
              Math.round(pt.lat * 1000) + "," + Math.round(pt.lng * 1000);
            if (seen.has(key)) return;
            seen.add(key);
            const np = policeStations.reduce((p, c) =>
              haversine(pt, c.pos) < haversine(pt, p.pos) ? c : p,
            );
            const nh = hospitals.reduce((p, c) =>
              haversine(pt, c.pos) < haversine(pt, p.pos) ? c : p,
            );
            L.circleMarker([np.pos.lat, np.pos.lng], {
              radius: 6,
              color: "#332",
              fillColor: "#ffcc00",
              fillOpacity: 1,
            }).addTo(map);
            L.circleMarker([nh.pos.lat, nh.pos.lng], {
              radius: 6,
              color: "#143",
              fillColor: "#22c55e",
              fillOpacity: 1,
            }).addTo(map);
          });
        }

        // Deviation + inactivity
        function pointToSegmentDistance(point, A, B) {
          const a = point.lat - A.lat,
            b = point.lng - A.lng,
            c = B.lat - A.lat,
            d = B.lng - A.lng;
          const dot = a * c + b * d,
            len = c * c + d * d;
          let param = len !== 0 ? dot / len : -1;
          let xx, yy;
          if (param < 0) {
            xx = A.lat;
            yy = A.lng;
          } else if (param > 1) {
            xx = B.lat;
            yy = B.lng;
          } else {
            xx = A.lat + param * c;
            yy = A.lng + param * d;
          }
          const dx = point.lat - xx,
            dy = point.lng - yy;
          return Math.sqrt(dx * dx + dy * dy) * 111320;
        }
        function checkRouteDeviation(p) {
          if (!plannedRoute || plannedRoute.length < 2) return;
          let min = Infinity;
          for (let i = 0; i < plannedRoute.length - 1; i++) {
            const d = pointToSegmentDistance(
              p,
              plannedRoute[i],
              plannedRoute[i + 1],
            );
            if (d < min) min = d;
          }
          if (min > 80) {
            const a = {
              id: uuidv4(),
              touristId,
              name: currentUser.name,
              type: "Route Deviation",
              location: `${p.lat.toFixed(6)},${p.lng.toFixed(6)}`,
              time: new Date().toLocaleString(),
              priority: "Medium",
            };
            addAlert(a);
            visualizeAnomalyOnAuthority(a);
            speak(ttsKey("offRoute"));
            notify("You have deviated from your planned route");
          }
        }

        function startInactivityMonitoring() {
          inactivityTimer = setInterval(() => {
            if (!userMarker) return;
            const cur = userMarker.getLatLng();
            if (lastPosition && cur) {
              const dist = haversine(
                { lat: lastPosition.lat, lng: lastPosition.lng },
                { lat: cur.lat, lng: cur.lng },
              );
              if (dist < 10) {
                if (!stationaryStartTime) {
                  stationaryStartTime = new Date();
                } else {
                  const secs = (new Date() - stationaryStartTime) / 1000;
                  if (secs > 120) {
                    const a = {
                      id: uuidv4(),
                      touristId,
                      name: currentUser.name,
                      type: "Inactivity Alert",
                      location: `${cur.lat.toFixed(6)},${cur.lng.toFixed(6)}`,
                      time: new Date().toLocaleString(),
                      priority: "Medium",
                    };
                    addAlert(a);
                    visualizeAnomalyOnAuthority(a);
                    speak(ttsKey("stillness"));
                    notify("You have been stationary for a while");
                    stationaryStartTime = null;
                  }
                }
              } else {
                stationaryStartTime = null;
              }
              lastPosition = cur;
            } else {
              lastPosition = cur;
            }
          }, 30000);
        }
        function resetInactivityTimer() {
          if (!userMarker) return;
          lastPosition = userMarker.getLatLng();
          stationaryStartTime = null;
        }

        // Family tracking toggle
        window.toggleFamilyTracking = function () {
          const btn = $("#btn-family");
          if (familyInterval) {
            clearInterval(familyInterval);
            familyInterval = null;
            if (map.hasLayer(familyMarker)) map.removeLayer(familyMarker);
            btn.textContent = "Start Family Tracking";
            alert("Family tracking stopped.");
            return;
          }
          const center = userMarker?.getLatLng?.();
          if (!center) {
            alert("Start location first");
            return;
          }
          if (!map.hasLayer(familyMarker)) familyMarker.addTo(map);
          familyInterval = setInterval(() => {
            const offLat = (Math.random() - 0.5) * 0.01,
              offLng = (Math.random() - 0.5) * 0.01;
            const np = { lat: center.lat + offLat, lng: center.lng + offLng };
            familyMarker.setLatLng([np.lat, np.lng]);
          }, 5000);
          btn.textContent = "Stop Family Tracking";
          alert("Family tracking started.");
        };

        // Panic & share
        window.triggerPanicAlert = function () {
          const pos = userMarker?.getLatLng?.();
          if (!pos) {
            alert("Location not available");
            return;
          }
          const nearPolice = policeStations.reduce((p, c) =>
            haversine({ lat: pos.lat, lng: pos.lng }, c.pos) <
            haversine({ lat: pos.lat, lng: pos.lng }, p.pos)
              ? c
              : p,
          );
          const a = {
            id: uuidv4(),
            touristId,
            name: currentUser.name,
            type: "Panic",
            location: `${pos.lat.toFixed(6)},${pos.lng.toFixed(6)}`,
            time: new Date().toLocaleString(),
            priority: "Critical",
          };
          addAlert(a);
          visualizeAnomalyOnAuthority(a);
          document.body.style.backgroundColor = "#ff0000";
          setTimeout(() => (document.body.style.backgroundColor = ""), 300);
          speak("Panic alert activated! Help is on the way.");
          notify("üö® PANIC ALERT ACTIVATED!");
          alert(`Nearest authority: ${nearPolice.name}\nContact: ${nearPolice.phone || '100'}\nAlert recorded and routed.`);
        };
        window.shareLocation = function () {
          const pos = userMarker?.getLatLng?.();
          if (pos) {
            const url = `https://maps.google.com/?q=${pos.lat},${pos.lng}`;
            const text = encodeURIComponent(
              "My TripGuard live location: " + url,
            );
            const wa = `https://wa.me/?text=${text}`;
            const sms = `sms:?&body=${text}`;
            window.open(wa, "_blank");
            setTimeout(() => window.open(sms, "_blank"), 500);
          } else {
            alert("Location not available");
          }
        };

        // Voice
        window.startVoiceControl = function () {
          const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
          if (!SR) {
            alert("Speech recognition not supported");
            return;
          }
          speechRec = new SR();
          speechRec.continuous = true;
          speechRec.interimResults = true;
          speechRec.lang = uiLanguage;
          speechRec.onresult = (e) => {
            for (let i = e.resultIndex; i < e.results.length; i++) {
              if (e.results[i].isFinal) {
                const t = e.results[i][0].transcript.toLowerCase();
                if (t.includes("panic")) {
                  triggerPanicAlert();
                  speechRec.stop();
                }
              }
            }
          };
          speechRec.start();
          alert("Voice control activated. Say 'panic'.");
        };

        // Feedback
        window.setRating = function (r) {
          ratingValue = r;
          for (let i = 1; i <= 5; i++) {
            document.getElementById("star" + i).style.color =
              i <= r ? "#f59e0b" : "#ccc";
          }
        };
        window.submitFeedback = function () {
          const text = $("#feedback-input").value.trim();
          if (!text) {
            alert("Please enter your feedback");
            return;
          }
          const fb = {
            id: uuidv4(),
            touristId,
            name: currentUser?.name || "Tourist",
            rating: ratingValue || 5,
            text,
            time: new Date().toLocaleString(),
          };
          feedbackList.unshift(fb);
          saveFeedbackList();
          alert("Thank you for your feedback!");
          $("#feedback-input").value = "";
          setRating(0);
        };
        window.viewFeedback = function () {
          alert("Total feedback entries: " + feedbackList.length);
        };

        window.showItinerary = function () {
          if (!plannedRoute || !plannedRoute.length) {
            alert("No itinerary yet. Use Route Planner.");
            return;
          }
          let total = 0;
          for (let i = 0; i < plannedRoute.length - 1; i++) {
            total += haversine(plannedRoute[i], plannedRoute[i + 1]);
          }
          const lines = plannedRoute
            .map((p, i) => `${i + 1}. ${p.lat.toFixed(5)}, ${p.lng.toFixed(5)}`)
            .join("\n");
          alert(
            `Itinerary (stops: ${plannedRoute.length})\nTotal distance: ${(total / 1000).toFixed(1)} km\n\n${lines}`,
          );
        };

        // Alerts list
        function renderAlerts() {
          const list = $("#alerts-list");
          list.innerHTML = "";
          if (activeAlerts.length === 0) {
            list.innerHTML = '<div class="muted">No active alerts</div>';
            return;
          }
          activeAlerts.forEach((a) => {
            const el = document.createElement("div");
            el.className = "alert-item";
            el.innerHTML = `<div><strong>${a.type}</strong> - ${a.name || ""}</div><div class=\"muted\">Location: ${a.location || "-"}</div><div class=\"muted\">Time: ${a.time}</div>`;
            list.appendChild(el);
          });
        }

        // EFIR
        window.generateEFIR = function () {
          const name = $("#efir-name").value,
            id = $("#efir-id").value,
            loc = $("#efir-location").value,
            details = $("#efir-details").value;
          if (!name || !id || !loc || !details) {
            alert("Please fill all fields");
            return;
          }
          const content = `ELECTRONIC FIRST INFORMATION REPORT (E-FIR)\n==========================================\n\nTourist Name: ${name}\nTourist ID: ${id}\nIncident Location: ${loc}\nReport Time: ${new Date().toLocaleString()}\n\nIncident Details:\n${details}\n\nThis is a simulated E-FIR for demonstration purposes only.`;
          const blob = new Blob([content], { type: "text/plain" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `EFIR-${id}-${Date.now()}.txt`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
          alert("E-FIR generated and downloaded");
        };

        // Simulations
        window.simulateDeviation = function () {
          const log = $("#analytics-log");
          log.innerHTML =
            '<div class="alert-item">Simulating route deviation...</div>' +
            log.innerHTML;
          const pos = userMarker?.getLatLng?.();
          if (pos) {
            const a = {
              id: uuidv4(),
              touristId,
              name: currentUser?.name,
              type: "Simulated Deviation",
              location: `${pos.lat.toFixed(6)},${pos.lng.toFixed(6)}`,
              time: new Date().toLocaleString(),
              priority: "Medium",
            };
            addAlert(a);
          }
        };
        window.simulateDropoff = function () {
          const log = $("#analytics-log");
          log.innerHTML =
            '<div class="alert-item">Simulating sudden drop-off...</div>' +
            log.innerHTML;
          const pos = userMarker?.getLatLng?.();
          if (pos) {
            const a = {
              id: uuidv4(),
              touristId,
              name: currentUser?.name,
              type: "Simulated Drop-off",
              location: `${pos.lat.toFixed(6)},${pos.lng.toFixed(6)}`,
              time: new Date().toLocaleString(),
              priority: "High",
            };
            addAlert(a);
          }
        };
        window.simulateInactivity = function () {
          const log = $("#analytics-log");
          log.innerHTML =
            '<div class="alert-item">Simulating prolonged inactivity...</div>' +
            log.innerHTML;
          const pos = userMarker?.getLatLng?.();
          if (pos) {
            const a = {
              id: uuidv4(),
              touristId,
              name: currentUser?.name,
              type: "Simulated Inactivity",
              location: `${pos.lat.toFixed(6)},${pos.lng.toFixed(6)}`,
              time: new Date().toLocaleString(),
              priority: "Medium",
            };
            addAlert(a);
          }
        };

        // UI Nav
        window.switchTab = function (event, tabName) {
          document
            .querySelectorAll(".tab-btn")
            .forEach((b) => b.classList.remove("active"));
          if (event) {
            event.currentTarget.classList.add("active");
          } else {
            document
              .querySelector(`[data-tab="${tabName}"]`)
              .classList.add("active");
          }
          document
            .querySelectorAll(".tab-pane")
            .forEach((p) => p.classList.remove("active"));
          document.getElementById(tabName + "-tab").classList.add("active");
        };
        window.switchAuthorityTab = function (event, tabName) {
          document
            .querySelectorAll(".sidebar-item")
            .forEach((i) => i.classList.remove("active"));
          event.currentTarget.classList.add("active");
          $("#efir-card").style.display = tabName === "efir" ? "block" : "none";
        };

        // Toggle form sections based on role
        (function(){
          const roleSel = document.getElementById('role-select');
          const touristKyc = document.getElementById('tourist-kyc');
          const authFields = document.getElementById('authority-fields');
          const idTypeSel = document.getElementById('id-type');
          const kycAadhar = document.getElementById('kyc-aadhar');
          const kycPassport = document.getElementById('kyc-passport');
          function syncRole(){
            if(roleSel.value === 'authority'){ touristKyc.style.display='none'; authFields.style.display='block'; }
            else { touristKyc.style.display='block'; authFields.style.display='none'; }
          }
          function syncId(){
            if((idTypeSel?.value||'aadhar') === 'passport'){ kycAadhar.style.display='none'; kycPassport.style.display='block'; }
            else { kycAadhar.style.display='block'; kycPassport.style.display='none'; }
          }
          roleSel.addEventListener('change', syncRole);
          idTypeSel?.addEventListener('change', syncId);
          syncRole(); syncId();
        })();

        document
          .getElementById("language-select")
          .addEventListener("change", function () {
            uiLanguage = this.value;
            applyLanguage();
          });

        const I18N = {
          en: {
            tourist_interface: "Tourist Interface",
            authority_dashboard: "Authority Dashboard",
            analytics: "Analytics",
            login: "Login",
            register: "Register",
            authority_login: "Authority Login",
            route_planner: "Route Planner",
            start_family: "Start Family Tracking",
            share_location: "Share Location",
            my_itinerary: "My Itinerary",
            panic: "Panic",
            voice_control: "Start Voice Control (say 'panic')",
            active_alerts: "Active Alerts",
          },
          hi: {
            tourist_interface: "‡§™‡§∞‡•ç‡§Ø‡§ü‡§ï ‡§á‡§Ç‡§ü‡§∞‡§´‡§º‡•á‡§∏",
            authority_dashboard: "‡§™‡•ç‡§∞‡§æÔøΩÔøΩÔøΩ‡§ø‡§ï‡§∞‡§£ ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°",
            analytics: "‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£",
            login: "‡§≤‡•â‡§ó‡§ø‡§®",
            register: "‡§∞ÔøΩÔøΩ‡§ø‡§∏‡•ç‡§ü‡§∞",
            authority_login: "‡§™‡•ç‡§∞‡§æ‡§ß‡§ø‡§ï‡§∞‡§£ ‡§≤‡•â‡§ó‡§ø‡§®",
            route_planner: "‡§∞‡•Ç‡§ü ‡§™‡•ç‡§≤‡§æ‡§®‡§∞",
            start_family: "‡§™‡§∞‡§ø‡§µ‡§æ‡§∞ ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç",
            share_location: "‡§∏‡•ç‡§•‡§æ‡§® ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç",
            my_itinerary: "‡§Æ‡•á‡§∞‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§Ø‡•ã‡§ú‡§®‡§æ",
            panic: "‡§™‡•à‡§®‡§ø‡§ï",
            voice_control: "‡§µ‡•â‡§á‡§∏ ‡§ï‡§Ç‡§ü‡•ç‡§∞‡•ã‡§≤ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç (‡§ï‡§π‡•á‡§Ç 'panic')",
            active_alerts: "‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§Ö‡§≤‡§∞‡•ç‡§ü",
          },
          bn: {
            tourist_interface: "‡¶™‡¶∞‡ßç‡¶Ø‡¶ü‡¶ï ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶´‡ßá‡¶∏",
            authority_dashboard: "‡¶ï‡¶∞‡ßç‡¶§‡ßÉ‡¶™‡¶ï‡ßç‡¶∑ ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°",
            analytics: "‡¶¨‡¶ø‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶£",
            login: "‡¶≤‡¶ó‡¶á‡¶®",
            register: "‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞",
            authority_login: "‡¶ï‡¶∞‡ßç‡¶§‡ßÉ‡¶™‡¶ï‡ßç‡¶∑ ‡¶≤‡¶ó‡¶á‡¶®",
            route_planner: "‡¶∞‡ßÅ‡¶ü ‡¶™‡¶∞‡¶ø‡¶ï‡¶≤‡ßç‡¶™‡¶®‡¶æ",
            start_family: "‡¶™‡¶∞‡¶ø‡¶¨‡¶æ‡¶∞ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç ‡¶∂‡ßÅ‡¶∞‡ßÅ",
            share_location: "‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®",
            my_itinerary: "‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶≠‡ßç‡¶∞‡¶Æ‡¶£‡¶∏‡ßÇ‡¶ö‡¶ø",
            panic: "‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶ï",
            voice_control: "‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶® ('panic' ‡¶¨‡¶≤‡ßÅ‡¶®)",
            active_alerts: "‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ",
          },
          mr: {
            tourist_interface: "‡§™‡§∞‡•ç‡§Ø‡§ü‡§ï ‡§á‡§Ç‡§ü‡§∞‡§´‡•á‡§∏",
            authority_dashboard: "‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞‡•ç‚Äç‡§Ø‡§æ‡§Ç‡§ö‡§æ ‡§°‡•Ö‡§∂‡§¨‡•ã‡§∞‡•ç‡§°",
            analytics: "‡§µ‡§ø‡§∂‡•ç‚Äç‡§≤‡•á‡§∑‡§£",
            login: "‡§≤‡•â‡§ó‡§ø‡§®",
            register: "‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä",
            authority_login: "‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞‡•ç‚Äç‡§Ø‡§æ‡§Ç‡§ö‡•á ‡§≤‡•â‡§ó‡§ø‡§®",
            route_planner: "‡§Æ‡§æ‡§∞‡•ç‡§ó ‡§®‡§ø‡§Ø‡•ã‡§ú‡§ï",
            start_family: "‡§ï‡•Å‡§ü‡•Å‡§Ç‡§¨ ‡§ü‡•ç‡§∞‡•Ö‡§ï‡§ø‡§Ç‡§ó ‡§∏‡•Å‡§∞‡•Ç",
            share_location: "‡§∏‡•ç‡§•‡§æ‡§® ‡§∂‡•á‡§Ö‡§∞ ‡§ï‡§∞‡§æ",
            my_itinerary: "‡§Æ‡§æ‡§ù‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ",
            panic: "‡§™‡•Ö‡§®‡§ø‡§ï",
            voice_control: "‡§µ‡•ç‡§π‡•â‡§à‡§∏ ‡§ï‡§Ç‡§ü‡•ç‡§∞‡•ã‡§≤ ‡§∏‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§æ ('panic' ‡§Æ‡•ç‡§π‡§£‡§æ)",
            active_alerts: "‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§Ö‡§≤‡§∞‡•ç‡§ü",
          },
          te: {
            tourist_interface: "‡∞ü‡±Ç‡∞∞‡∞ø‡∞∏‡±ç‡∞ü‡±Å ‡∞á‡∞Ç‡∞ü‡∞∞ÔøΩÔøΩÔøΩ‚Äå‡∞´‡±á‡∞∏‡±ç",
            authority_dashboard: "‡∞Ö‡∞•‡∞æ‡∞∞‡∞ø‡∞ü‡±Ä ‡∞°‡±ç‡∞Ø‡∞æ‡∞∑‡±ç‚Äå‡∞¨‡±ã‡∞∞‡±ç‡∞°‡±ç",
            analytics: "‡∞µ‡∞ø‡∞∂ÔøΩÔøΩÔøΩ‡∞≤‡±á‡∞∑‡∞£",
            login: "‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç",
            register: "‡∞®‡∞Æ‡±ã‡∞¶‡±Å",
            authority_login: "‡∞Ö‡∞•‡∞æ‡∞∞‡∞ø‡∞ü‡±Ä ‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç",
            route_planner: "‡∞∞‡±Ç‡∞ü‡±ç ‡∞™‡±ç‡∞≤‡∞æ‡∞®‡∞∞‡±ç",
            start_family: "‡∞´‡±ç‡∞Ø‡∞æ‡∞Æ‡∞ø‡∞≤‡±Ä ‡∞ü‡±ç‡∞∞‡∞æ‡∞ï‡∞ø‡∞Ç‡∞ó‡±ç ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø",
            share_location: "‡∞≤‡±ã‡∞ï‡±á‡∞∑‡∞®‡±ç ‡∞™‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø",
            my_itinerary: "‡∞®‡∞æ ‡∞™‡±ç‡∞∞‡∞Ø‡∞æ‡∞£ ‡∞™‡±ç‡∞∞‡∞£‡∞æ‡∞≥‡∞ø‡∞ï",
            panic: "‡∞™‡∞æ‡∞®‡∞ø‡∞ï‡±ç",
            voice_control: "‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç ‡∞®‡∞ø‡∞Ø‡∞Ç‡∞§‡±ç‡∞∞‡∞£ ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø ('panic' ‡∞Ö‡∞®‡∞Ç‡∞°‡∞ø)",
            active_alerts: "‡∞ï‡±ç‡∞∞‡∞ø‡∞Ø‡∞æ‡∞∂‡±Ä‡∞≤ ‡∞Ö‡∞≤‡±Ü‡∞∞‡±ç‡∞ü‡±ç‡∞≤‡±Å",
          },
          ta: {
            tourist_interface: "‡Æö‡ØÅ‡Æ±‡Øç‡Æ±‡ØÅ‡Æ≤‡Ææ ‡Æá‡Æü‡Øà‡ÆÆ‡ØÅ‡Æï‡ÆÆ‡Øç",
            authority_dashboard: "‡ÆÖ‡Æ§‡Æø‡Æï‡Ææ‡Æ∞ ‡Æ™‡Æ≤‡Æï‡Øà",
            analytics: "‡ÆÜ‡ÆØ‡Øç‡Æµ‡ØÅ‡Æï‡Æ≥‡Øç",
            login: "‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà‡Æï",
            register: "‡Æ™‡Æ§‡Æø‡Æµ‡ØÅ",
            authority_login: "‡ÆÖ‡Æ§‡Æø‡Æï‡Ææ‡Æ∞‡Æø ‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà‡Æµ‡ØÅ",
            route_planner: "‡Æ™‡Ææ‡Æ§‡Øà ‡Æ§‡Æø‡Æü‡Øç‡Æü‡ÆÆ‡Æø‡Æü‡Æ≤‡Øç",
            start_family: "‡Æï‡ØÅ‡Æü‡ØÅ‡ÆÆ‡Øç‡Æ™ ‡Æï‡Æ£‡Øç‡Æï‡Ææ‡Æ£‡Æø‡Æ™‡Øç‡Æ™‡ØÅ ‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï‡ØÅ",
            share_location: "‡Æá‡Æ∞‡ØÅ‡Æ™‡Øç‡Æ™‡ÆøÔøΩÔøΩ‡ÆÆ‡Øç ÔøΩÔøΩÔøΩ‡Æï‡Æø‡Æ∞‡Æµ‡ØÅ‡ÆÆ‡Øç",
            my_itinerary: "‡Æé‡Æ©‡Øç ‡Æ™‡ÆØ‡Æ£ ‡Æ§‡Æø‡Æü‡Øç‡Æü‡ÆÆ‡Øç",
            panic: "‡Æ™‡ØÄ‡Æ§‡Æø",
            voice_control: "‡Æï‡ØÅ‡Æ∞‡Æ≤‡Øç ‡Æï‡Æü‡Øç‡Æü‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡Æü‡Øç‡Æü‡Øà ‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï‡ØÅ ('panic' ‡Æö‡Øä‡Æ≤‡Øç)",
            active_alerts: "‡Æö‡ØÜ‡ÆØ‡Æ≤‡Æø‡Æ≤‡Øç ‡Æé‡Æö‡Øç‡Æö‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Øà‡Æï‡Æ≥‡Øç",
          },
          kn: {
            tourist_interface: "‡≤™‡≥ç‡≤∞‡≤µ‡≤æ‡≤∏‡≤ø ‡≤á‡≤Ç‡≤ü‡≤∞‡≥ç‡≤´‡≥á‡≤∏‡≥ç",
            authority_dashboard: "‡≤Ö‡≤ß‡≤ø‡≤ï‡≤æ‡≤∞‡≤ø ‡≤°‡≥ç‡≤Ø‡≤æ‡≤∂‡≥ç‚Äå‡≤¨‡≥ã‡≤∞‡≥ç‡≤°‡≥ç",
            analytics: "‡≤µ‡≤ø‡≤∂‡≥ç‡≤≤‡≥á‡≤∑‡≤£‡≥Ü",
            login: "‡≤≤‡≤æ‡≤ó‡≤ø‡≤®‡≥ç",
            register: "‡≤®‡≥ã‡≤Ç‡≤¶‡≤£‡≤ø",
            authority_login: "‡≤Ö‡≤ß‡≤ø‡≤ï‡≤æ‡≤∞‡≤ø ‡≤≤‡≤æ‡≤ó‡≤ø‡≤®‡≥ç",
            route_planner: "‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ó ‡≤Ø‡≥ã‡≤ú‡≤ï",
            start_family: "‡≤ï‡≥Å‡≤ü‡≥Å‡≤Ç‡≤¨ ‡≤ü‡≥ç‡≤∞‡≥ç‡≤Ø‡≤æ‡≤ï‡≤ø‡≤Ç‡≤ó‡≥ç ‡≤™‡≥ç‡≤∞‡≤æ‡≤∞‡≤Ç‡≤≠‡≤ø‡≤∏‡≤ø",
            share_location: "‡≤∏‡≥ç‡≤•‡≤≥ ‡≤π‡≤Ç‡≤ö‡≤ø‡≤ï‡≥Ü",
            my_itinerary: "‡≤®‡≤®‡≥ç‡≤® ‡≤™‡≥ç‡≤∞‡≤Ø‡≤æ‡≤£ ‡≤Ø‡≥ã‡≤ú‡≤®‡≥Ü",
            panic: "‡≤ó‡≤æ‡≤¨‡≤∞‡≤ø",
            voice_control: "‡≤µ‡≤æ‡≤Ø‡≥ç‡≤∏‡≥ç ‡≤®‡≤ø‡≤Ø‡≤Ç‡≤§‡≥ç‡≤∞‡≤£ ‡≤™‡≥ç‡≤∞‡≤æ‡≤∞‡≤Ç‡≤≠‡≤ø‡≤∏‡≤ø ('panic' ‡≤é‡≤Ç‡≤¶‡≥Å ‡≤π‡≥á‡≤≥‡≤ø)",
            active_alerts: "‡≤∏‡≤ï‡≥ç‡≤∞‡≤ø‡≤Ø ‡≤é‡≤ö‡≥ç‡≤ö‡≤∞‡≤ø‡≤ï‡≥Ü‡≤ó‡≤≥‡≥Å",
          },
          ml: {
            tourist_interface: "‡¥∏‡¥û‡µç‡¥ö‡¥æ‡¥∞‡¥ø ‡¥á‡¥®‡µç‡¥±‡µº‡¥´‡µá‡¥∏‡µç",
            authority_dashboard: "‡¥Ö‡¥ß‡¥ø‡¥ï‡¥æ‡¥∞‡¥ø ‡¥°‡¥æ‡¥∑‡µç‡¥¨‡µã‡µº‡¥°‡µç",
            analytics: "‡¥µ‡¥ø‡¥∂‡¥ï‡¥≤‡¥®‡¥Ç",
            login: "‡¥≤‡µã‡¥ó‡¥ø‡µª",
            register: "‡¥∞‡¥ú‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡µº",
            authority_login: "‡¥Ö‡¥ß‡¥ø‡¥ï‡¥æ‡¥∞‡¥ø ‡¥≤‡µã‡¥ó‡¥ø‡µª",
            route_planner: "‡¥±‡µÇ‡¥ü‡µç‡¥ü‡µç ‡¥™‡µç‡¥≤‡¥æ‡¥®‡µº",
            start_family: "‡¥ï‡µÅ‡¥ü‡µÅ‡¥Ç‡¥¨ ‡¥ü‡µç‡¥∞‡¥æ‡¥ï‡µç‡¥ï‡¥ø‡¥Ç‡¥ó‡µç ‡¥Ü‡¥∞‡¥Ç‡¥≠‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï",
            share_location: "‡¥≤‡µä‡¥ï‡µç‡¥ï‡µá‡¥∑‡µª ‡¥™‡¥ô‡µç‡¥ï‡¥ø‡¥ü‡µÅ‡¥ï",
            my_itinerary: "‡¥é‡¥®‡µç‡¥±‡µÜ ‡¥Ø‡¥æ‡¥§‡µç‡¥∞",
            panic: "‡¥™‡¥æ‡¥®‡¥ø‡¥ï‡µç",
            voice_control: "‡¥µ‡µã‡¥Ø‡µç‡¥∏‡µç ‡¥®‡¥ø‡¥Ø‡¥®‡µç‡¥§‡µç‡¥∞‡¥£‡¥Ç ‡¥Ü‡¥∞‡¥Ç‡¥≠‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï ('panic' ‡¥™‡¥±‡¥Ø‡µÅ‡¥ï)",
            active_alerts: "‡¥∏‡¥ú‡µÄ‡¥µ ‡¥Ö‡¥≤‡µº‡¥ü‡µç‡¥ü‡µÅ‡¥ï‡µæ",
          },
          gu: {
            tourist_interface: "‡™™‡™∞‡´ç‡™Ø‡™ü‡™ï ‡™á‡™®‡´ç‡™ü‡™∞‡™´‡´á‡™∏",
            authority_dashboard: "‡™∏‡™§‡´ç‡™§‡™æ‡™µ‡™æ‡™≥‡™æ‡™®‡´ã ‡™°‡´Ö‡™∂‡™¨‡´ã‡™∞‡´çÔøΩÔøΩ",
            analytics: "‡™µ‡™ø‡™∂‡´ç‡™≤‡´á‡™∑‡™£",
            login: "‡™≤‡´â‡™ó‡™ø‡™®",
            register: "‡™∞‡™ú‡´Ä‡™∏‡´ç‡™ü‡™∞",
            authority_login: "‡™∏‡™§‡´ç‡™§‡™æ‡™µ‡™æ‡™≥‡™æ‡™®‡´Å‡™Ç ‡™≤‡´â‡™ó‡™ø‡™®",
            route_planner: "‡™Æ‡™æ‡™∞‡´ç‡™ó ‡™Ü‡™Ø‡´ã‡™ú‡™®",
            start_family: "‡™´‡´á‡™Æ‡™ø‡™≤‡´Ä ‡™ü‡´ç‡™∞‡´á‡™ï‡™ø‡™Ç‡™ó ‡™∂‡™∞‡´Ç ‡™ï‡™∞‡´ã",
            share_location: "‡™∏‡´ç‡™•‡™æ‡™® ‡™∂‡´á‡™∞ ‡™ï‡™∞‡´ã",
            my_itinerary: "‡™Æ‡™æ‡™∞‡´Ä ‡™Ø‡™æ‡™§‡´ç‡™∞‡™æ",
            panic: "‡™™‡´á‡™®‡™ø‡™ï",
            voice_control: "‡™µ‡´ã‡™á‡™∏ ‡™ï‡™Ç‡™ü‡´ç‡™∞‡´ã‡™≤ ‡™∂‡™∞‡´Ç ‡™ï‡™∞‡´ã ('panic' ‡™ï‡™π‡´ã)",
            active_alerts: "‡™∏‡™ï‡´ç‡™∞‡™ø‡™Ø ‡™è‡™≤‡™∞‡´ç‡™ü‡´ç‡™∏",
          },
          pa: {
            tourist_interface: "‡®™‡®∞‡©ç‡®Ø‡®ü‡®ï ‡®á‡©∞‡®ü‡®∞‡®´‡©á‡®∏",
            authority_dashboard: "‡®Ö‡®•‡©å‡®∞‡®ü‡©Ä ‡®°‡©à‡®∏‡®º‡®¨‡©ã‡®∞‡®°",
            analytics: "‡®µ‡®ø‡®∂‡®≤‡©á‡®∏‡®º‡®£",
            login: "‡®≤‡©å‡®ó‡®á‡®®",
            register: "‡®∞‡®ú‡®ø‡®∏‡®ü‡®∞",
            authority_login: "‡®Ö‡®•‡©å‡®∞‡®ü‡©Ä ‡®≤‡©å‡®ó‡®á‡®®",
            route_planner: "‡®∞‡©Ç‡®ü ‡®™‡®≤‡©à‡®®‡®∞",
            start_family: "‡®™‡®∞‡®ø‡®µÔøΩÔøΩ‡®∞ ‡®ü‡©ç‡®∞‡©à‡®ï‡™ø‡™Ç‡™ó ‡®∏‡®º‡©Å‡®∞‡©Ç ‡®ï‡®∞‡©ã",
            share_location: "‡®≤‡©ã‡®ï‡©á‡®∏‡®º‡®® ‡®∏‡®æ‡®Ç‡®ù‡©Ä ‡®ï‡®∞‡©ã",
            my_itinerary: "‡®Æ‡©á‡®∞‡©Ä ‡®Ø‡®æ‡®§‡®∞‡®æ",
            panic: "‡®™‡©à‡®®‡®ø‡®ï",
            voice_control: "‡®µ‡©å‡®á‡®∏ ‡®ï‡©∞‡®ü‡®∞‡©ã‡®≤ ‡®∏‡®º‡©Å‡®∞‡©Ç ‡®ï‡®∞‡©ã ('panic' ‡®ï‡®π‡©ã)",
            active_alerts: "‡®∏‡®ï‡©ç‡®∞‡®ø‡®Ü ‡®ö‡©á‡®§‡®æ‡®µ‡®®‡©Ä‡®Ü‡®Ç",
          },
          or: {
            tourist_interface: "‡¨™‡¨∞‡≠ç‡¨Ø‡≠ç‡≠ü‡¨ü‡¨ï ‡¨á‡¨£‡≠ç‡¨ü‡¨∞‡¨´‡≠á‡¨∏",
            authority_dashboard: "‡¨ï‡¨∞‡≠ç‡¨§‡≠ç‡¨§‡≠É‡¨™‡¨ï‡≠ç‡¨∑ ‡¨°‡¨æ‡¨∂‡¨¨‡≠ã‡¨∞‡≠ç‡¨°",
            analytics: "‡¨¨‡¨ø‡¨∂‡≠ç‡¨≥‡≠á‡¨∑‡¨£",
            login: "‡¨≤‡¨ó‡≠ç-‡¨á‡¨®‡≠ç",
            register: "‡¨∞‡≠á‡¨ú‡¨ø‡¨∑‡≠ç‡¨ü‡¨∞‡≠ç",
            authority_login: "‡¨ï‡¨∞‡≠ç‡¨§‡≠ç‡¨§‡≠É‡¨™‡¨ï‡≠ç‡¨∑ ‡¨≤‡¨ó‡¨ø‡¨®‡≠ç",
            route_planner: "‡¨∞‡≠Å‡¨ü‡≠ç ‡¨™‡≠ç‡¨≤‡¨æ‡¨®‡¨∞‡≠ç",
            start_family: "‡¨™‡¨∞‡¨ø‡¨¨‡¨æ‡¨∞ ‡¨ü‡≠ç‡¨∞‡¨æ‡¨ï‡¨ø‡¨Ç ‡¨Ü‡¨∞‡¨Æ‡≠ç‡¨≠ ‡¨ï‡¨∞‡¨®‡≠ç‡¨§‡≠Å",
            share_location: "‡¨Ö‡¨¨‡¨∏‡≠ç‡¨•‡¨æ‡¨® ‡¨∏‡≠á‡≠ü‡¨æ‡¨∞‡≠ç ‡¨ï‡¨∞‡¨®‡≠ç‡¨§‡≠Å",
            my_itinerary: "‡¨Æ‡≠ã ‡¨Ø‡¨æ‡¨§‡≠ç‡¨∞‡¨æ",
            panic: "‡¨™‡≠ç‡≠ü‡¨æ‡¨®‡¨ø‡¨ï‡≠ç",
            voice_control: "‡¨≠‡¨è‡¨∏‡≠ç ‡¨ï‡¨£‡≠ç‡¨ü‡≠ç‡¨∞‡≠ã‡¨≤ ‡¨Ü‡¨∞‡¨ÆÔøΩÔøΩÔøΩ‡¨≠ ‡¨ï‡¨∞‡¨®‡≠ç‡¨§‡≠Å ('panic' ‡¨ï‡≠Å‡¨π‡¨®‡≠ç‡¨§‡≠Å)",
            active_alerts: "‡¨∏‡¨ï‡≠ç‡¨∞‡¨ø‡≠ü ‡¨∏‡¨§‡¨∞‡≠ç‡¨ï‡¨§‡¨æ",
          },
          as: {
            tourist_interface: "‡¶™‡¶∞‡ßç‡¶Ø‡¶ü‡¶ï ‡¶á‡¶£‡ßç‡¶ü‡¶æ‡ß∞‡¶´‡ßá‡¶ö",
            authority_dashboard: "‡¶ï‡¶∞‡ßç‡¶§‡ßÉ‡¶™‡¶ï‡ßç‡¶∑ ‡¶°‡ßá‡¶∂‡ßçÔøΩÔøΩÔøΩ‡¶¨‡ß∞‡ßç‡¶°",
            analytics: "‡¶¨‡¶ø‡¶∂‡ßç‡¶≤ÔøΩÔøΩ‡¶∑‡¶£",
            login: "‡¶≤‡¶ó‡¶ø‡¶®",
            register: "‡ß∞‡ßá‡¶ú‡¶ø‡¶∑‡ßç‡¶ü‡¶æ‡ß∞",
            authority_login: "‡¶ï‡¶∞‡ßç‡¶§‡ßÉ‡¶™‡¶ï‡ßç‡¶∑ ‡¶≤‡¶ó‡¶ø‡¶®",
            route_planner: "‡ß∞‡ßÅ‡¶ü ‡¶™‡ß∞‡¶ø‡¶ï‡¶≤‡ßç‡¶™‡¶®‡¶æ",
            start_family: "‡¶™‡ß∞‡¶ø‡ßü‡¶æ‡¶≤ ‡¶ü‡ßç‡ß∞‡ßá‡¶ï‡¶ø‡¶Ç ‡¶Ü‡ß∞‡¶Æ‡ßç‡¶≠ ‡¶ï‡ß∞‡¶ï",
            share_location: "‡¶Ö‡ß±‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶∂‡ßç‡¶¨‡ßá‡ßü‡¶æ‡ß∞ ‡¶ï‡ß∞‡¶ï",
            my_itinerary: "‡¶Æ º‡ß∞ ‡¶≠‡ßç‡ß∞‡¶Æ‡¶£‡¶∏‡ßÇ‡¶ö‡ßÄ",
            panic: "‡¶™‡ßá‡¶®‡¶ø‡¶ï",
            voice_control: "‡¶≠‡¶Ø‡¶º‡ßá‡¶õ ‡¶®‡¶ø‡¶Ø‡¶º‡¶®‡ßç‡¶§‡ßç‡ß∞‡¶£ ‡¶Ü‡ß∞‡¶Æ‡ßç‡¶≠ ‡¶ï‡ß∞‡¶ï ('panic' ‡¶ï'‡¶¨)",
            active_alerts: "‡¶∏‡¶ï‡ßç‡ß∞‡¶ø‡¶Ø‡¶º ‡¶∏‡¶§‡ß∞‡ßç‡¶ï‡¶¨‡¶æ‡¶£‡ßÄ",
          },
        };
        function applyLanguage() {
          const tr = I18N[uiLanguage] || I18N.en;
          document.querySelectorAll("[data-i18n]").forEach((el) => {
            const key = el.getAttribute("data-i18n");
            if (tr[key]) el.textContent = tr[key];
          });
        }

        updateCounts();
        applyLanguage();
      })();
    </script>
  </body>
</html>
